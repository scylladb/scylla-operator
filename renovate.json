{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended"
  ],
  "enabledManagers": [
    "custom.regex",
    "gomod",
    "pep621"
  ],
  "schedule": [
    "before 5am every weekday"
  ],
  "labels": [
    "kind/dependency-bump",
    "priority/important-longterm"
  ],
  "gomod": {
    "groupName": "gomod"
  },
  "postUpdateOptions": [
    "gomodTidy",
    "gomodVendor"
  ],
  "lockFileMaintenance": {
    "enabled": true
  },
  "packageRules": [
    {
      "description": "scylla-manager and scylla-manager-agent must be updated together",
      "matchDepNames": [
        "scylla-manager",
        "scylla-manager-agent"
      ],
      "groupName": "scylla-manager"
    },
    {
      "description": "go.mod dependencies that should not be updated (rule auto-generated by make update-renovate-config)",
      "matchPackageNames": [
        "github.com/gocql/gocql",
        "github.com/prometheus-operator/prometheus-operator/pkg/apis/monitoring",
        "github.com/prometheus-operator/prometheus-operator/pkg/client"
      ],
      "enabled": false
    },
    {
      "description": "Documentation dependencies",
      "matchManagers": [
        "pep621"
      ],
      "matchFileNames": [
        "docs/pyproject.toml"
      ],
      "groupName": "docs"
    },
    {
      "description": "Poetry version must be pinned to the one used in the container image",
      "matchPackageNames": [
        "poetry",
        "poetry-core"
      ],
      "matchFileNames": [
        "docs/pyproject.toml"
      ],
      "enabled": false
    }
  ],
  "customManagers": [
    {
      "description": "Custom manager for dependencies defined in assets/config/config.yaml with Renovate annotations matching the regex.",
      "customType": "regex",
      "managerFilePatterns": [
        "/^assets/config/config\\.yaml$/"
      ],
      "matchStrings": [
        "#\\s*renovate:\\s*datasource=(?<datasource>\\S+)\\s+depName=(?<depName>\\S+)(\\s+packageName=(?<packageName>\\S+))?(\\s+registryUrl=(?<registryUrl>\\S+))?(\\s+versioning=(?<versioning>\\S+))?\\s*\\n\\s*\\S+:\\s*\"?(?<currentValue>[^@\"\\s]+)(?:@(?<currentDigest>sha256:[a-f0-9]+))?\"?"
      ]
    },
    {
      "description": "Custom manager for dependencies defined in docs/source/conf.py with Renovate annotations matching the regex.",
      "customType": "regex",
      "managerFilePatterns": [
        "/^docs/source/conf\\.py$/"
      ],
      "matchStrings": [
        "#\\s*renovate:\\s*datasource=(?<datasource>\\S+)\\s+depName=(?<depName>\\S+)(\\s+packageName=(?<packageName>\\S+))?(\\s+registryUrl=(?<registryUrl>\\S+))?(\\s+versioning=(?<versioning>\\S+))?\\s*\\n\\s*\"\\S+\":\\s*\"(?<currentValue>[^\"]+)\""
      ]
    }
  ],
  "customDatasources": {
    "envtest": {
      "defaultRegistryUrlTemplate": "https://raw.githubusercontent.com/kubernetes-sigs/controller-tools/HEAD/envtest-releases.yaml",
      "format": "yaml",
      "transformTemplates": [
        "{ \"releases\": $map($keys(releases), function($v) { { \"version\": $v } }) }"
      ]
    }
  }
}
